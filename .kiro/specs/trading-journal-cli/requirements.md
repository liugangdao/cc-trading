# 交易日志 CLI 系统 - 需求文档

## 1. 项目概述

使用 Claude Code 作为智能 CLI 工具，通过对话式交互来记录和管理交易操作（开仓、平仓），并提供风险评估和交易优化分析。无需 UI 界面或后台服务，直接通过脚本和 JSONL 文件存储实现。

## 2. 用户故事

### 2.1 开仓记录
**作为** 交易员  
**我想要** 通过对话方式快速记录开仓信息  
**以便** 完整记录交易决策和风险管理参数

**验收标准：**
- 系统引导用户填写所有必要的开仓信息
- 自动生成唯一的仓位 ID
- 必须包含止损和止盈设置
- 支持多种市场类型（加密货币、外汇、黄金、白银、期货等）
- 数据保存到按月份命名的 JSONL 文件中
- 填写过程智能化，可以通过自然语言输入

### 2.2 平仓记录
**作为** 交易员  
**我想要** 选择未平仓的仓位并记录平仓信息  
**以便** 完整追踪交易的完整生命周期

**验收标准：**
- 显示所有未平仓的仓位列表
- 可以通过仓位 ID 选择要平仓的仓位
- 记录平仓价格、时间、实际盈亏
- 更新原有仓位记录的状态
- 支持部分平仓

### 2.3 交易查询
**作为** 交易员  
**我想要** 查看历史交易记录  
**以便** 回顾和分析交易表现

**验收标准：**
- 可以查看所有交易记录
- 可以筛选未平仓的仓位
- 可以按日期、品种、市场类型筛选
- 以清晰的表格或 JSON 格式展示

### 2.4 风险评估（通过 Claude Code）
**作为** 交易员  
**我想要** 通过 Claude Code 分析当前持仓的风险  
**以便** 控制整体风险敞口

**验收标准：**
- 提供预设的风险评估 Prompt
- Claude Code 读取 JSONL 文件并分析
- 计算当前所有未平仓位的总风险
- 显示每个仓位的风险回报比
- 评估仓位集中度
- 提供风险预警（如单一品种占比过高）
- 计算最大可能损失

### 2.5 交易优化建议（通过 Claude Code）
**作为** 交易员  
**我想要** 通过 Claude Code 获得基于历史数据的交易优化建议  
**以便** 改进交易策略和执行

**验收标准：**
- 提供预设的交易优化 Prompt
- Claude Code 读取历史 JSONL 文件并分析
- 分析胜率和盈亏比
- 识别表现最好/最差的交易品种
- 分析止损止盈设置的合理性
- 提供具体的优化建议
- 识别交易模式和习惯

### 2.6 自定义分析
**作为** 交易员  
**我想要** 直接向 Claude Code 提问任何关于交易数据的问题  
**以便** 获得灵活的、针对性的分析

**验收标准：**
- 可以直接在 Claude Code 中提问
- Claude Code 自动读取相关的 JSONL 文件
- 提供准确的数据分析和见解

## 3. 功能需求

### 3.1 开仓信息字段
- **仓位 ID**（自动生成，格式：`YYYYMMDD-HHMMSS-随机4位`）
- **交易品种**（如：BTC/USDT, EUR/USD, XAUUSD 等）
- **市场类型**（加密货币、外汇、黄金、白银、期货）
- **开仓时间**（自动记录或手动输入）
- **方向**（做多/做空）
- **开仓价格**
- **仓位大小**（数量/手数）
- **止损价格**（必填）
- **止盈价格**（必填）
- **保证金/成本**
- **交易理由/备注**（可选）
- **状态**（持仓中/已平仓）

### 3.2 平仓信息字段
- **仓位 ID**（从未平仓列表选择）
- **平仓时间**（自动记录或手动输入）
- **平仓价格**
- **平仓数量**（支持部分平仓）
- **实际盈亏**（自动计算）
- **盈亏百分比**（自动计算）
- **持仓时长**（自动计算）
- **平仓原因**（止损/止盈/手动平仓）
- **平仓备注**（可选）

### 3.3 数据存储
- 使用 JSONL 格式（每行一个 JSON 对象）
- 文件命名：`trades-YYYY-MM.jsonl`（如：`trades-2025-01.jsonl`）
- 存储位置：`./trading-data/` 目录
- 每个交易记录包含完整的开仓和平仓信息

### 3.4 CLI 命令功能
1. **开仓命令**（`trading-cli open`）
   - 交互式引导填写
   - 数据验证
   - 保存到 JSONL

2. **平仓命令**（`trading-cli close`）
   - 显示未平仓列表
   - 选择仓位并填写平仓信息
   - 更新 JSONL 记录

3. **查询命令**（`trading-cli list`）
   - 查看所有交易
   - 筛选功能（未平仓/已平仓/按日期/按品种）
   - 格式化输出（表格或 JSON）

**注：** 所有功能集成在一个 Golang CLI 工具中，通过子命令调用

### 3.5 分析功能（通过 Claude Code Prompt）
不需要专门的分析脚本，直接通过预设的 Prompt 让 Claude Code 读取 JSONL 文件进行分析：

1. **风险评估 Prompt**
   - 读取当前月份的交易数据
   - 分析未平仓位的风险敞口
   - 计算风险回报比和最大可能损失

2. **交易优化 Prompt**
   - 读取历史交易数据
   - 分析胜率、盈亏比、最佳/最差品种
   - 提供具体优化建议

3. **自定义分析 Prompt**
   - 用户可以直接问任何问题
   - Claude Code 灵活分析数据

## 4. 非功能需求

### 4.1 易用性
- 对话式交互，自然语言输入
- 智能提示和默认值
- 错误提示清晰友好

### 4.2 数据完整性
- 必填字段验证
- 数据格式验证
- 防止重复仓位 ID

### 4.3 可扩展性
- 易于添加新的市场类型
- 易于添加新的分析指标
- 支持自定义字段

### 4.4 性能
- 快速读写 JSONL 文件
- 支持大量历史记录查询

## 5. 技术约束

- 使用 Golang 实现脚本（编译为独立可执行文件）
- 数据存储使用 JSONL 格式
- 通过 Claude Code 对话界面运行脚本
- 无需数据库或 Web 服务器
- 跨平台兼容（Windows/Mac/Linux）
- 使用标准库为主，最小化外部依赖

## 6. 数据结构示例

```json
{
  "positionId": "20250120-143022-A7B3",
  "symbol": "BTC/USDT",
  "marketType": "crypto",
  "openTime": "2025-01-20T14:30:22Z",
  "direction": "long",
  "openPrice": 42500.00,
  "quantity": 0.5,
  "stopLoss": 41000.00,
  "takeProfit": 45000.00,
  "margin": 5000.00,
  "reason": "突破关键阻力位，RSI 超卖反弹",
  "status": "open",
  "closeTime": null,
  "closePrice": null,
  "closeQuantity": null,
  "realizedPnL": null,
  "pnlPercentage": null,
  "holdingDuration": null,
  "closeReason": null,
  "closeNote": null
}
```

## 7. 成功指标

- 开仓记录时间 < 2 分钟
- 平仓记录时间 < 1 分钟
- 数据准确率 100%
- 风险评估计算准确
- 用户满意度高（通过实际使用反馈）
